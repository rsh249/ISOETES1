###Instructions for building reference databases 
#cd into workspace directory **WHERE YOU INSTALLED other source directories (e.g., get_plastid_genes)


##Data: use ncbi2kraken.py
#get all* genbank data for chloroplasts (including green algae) *NOTE: seq length limited 200:5000.
./get_plastid_genes/ncbi2kraken.py -e 'rharbert@amnh.org' -s 'genbank[filter] AND (plants[filter] AND biomol_genomic[PROP]) AND (plants[filter] AND biomol_genomic[PROP] AND chloroplast[filter] AND ("200"[SLEN] : "5000"[SLEN]))' -o ./plants_genbank

#get all refseq chloroplast genomes.
./get_plastid_genes/ncbi2kraken.py -e 'rharbert@amnh.org' -s 'chloroplast[All Fields] AND (refseq[filter] AND chloroplast[filter]' -o ./plastids_refseq


#merge
cat ./plastids_refseq/final.fa ./plants_genbank/final.fa > ref.fa

## Make centrifuge compatible file

sed "s/|kraken:taxid|/ /" ref.fa > centref.fa

##Add to kraken database


##build centrifuge index files
#sub: get accession to taxid map file:
## get acc2taxid.map
wget ftp://ftp.ncbi.nih.gov/pub/taxonomy/accession2taxid/nucl_gb.accession2taxid.gz
gunzip nucl_gb.accession2taxid.gz
cut -f2,3 nucl_gb.accession2taxid > acc2tid.map

#build centrifuge taxonomy
centrifuge-download -o taxonomy taxonomy

####centrifuge-build -p 16 --bmax 819356040 --conversion-table /nas3/database/nt_fa/acc2tid.map --taxonomy-tree ../taxonomy/nodes.dmp --name-table ~/nas3/meta/taxonomy/names.dmp ~/nas3/meta/plants_genbank/final.fa ~/nas3/meta/centrifuge/nucind2


centrifuge-build -p 16 --bmax 819356040 --conversion-table acc2tid.map --taxonomy-tree ./taxonomy/nodes.dmp --name-table ./taxonomy/names.dmp ./centref.fa ./centrifuge/plants2


##Make blast database:
makeblastdb -in ./ref.fa -parse_seqids -dbtype nucl



